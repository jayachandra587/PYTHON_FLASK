<!doctype html>
<html>
  <head>
    <title> RTB Campaigns </title>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
      <script src="/static/handlebars/handlebars-v4.1.2.js"></script>
      <script src="/static/handlebars/campaigns.js"></script>
  </head>
  <body>
  <div class="container">
        <h2> RTB Portal </h2>
        <p> Realtime performance monitoring for RTB </p>
        <div id="both_regions_data"></div>
        <div id="west_campaigns_data"></div>
        <div id="east_campaigns_data"></div>
  </div>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script>
      var socket = io('http://52.13.211.25:5000/hello');

      socket.on('connect', function(){
        console.log('connection made');
        socket.emit('join', {'room':'queues'});
        socket.emit('queues_latest');
      });

      var template = Handlebars.templates['campaigns'];

      socket.on('queues_data_push', function(msg){
          $.each(msg, function(camp_id, camp_data){
              var templateData = template({campaigns:camp_data.stats, region:camp_data.region});
              $('#'+camp_id).html(templateData);
          });
      });
    </script>
  </body>
</html>